<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Naseem-e-Sehar Library</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f1724; /* dark background */
    --card:#0b1220;
    --muted:#9aa6b2;
    --accent:#6dd3ff;
    --glass: rgba(255,255,255,0.035);
    --glass-2: rgba(255,255,255,0.02);
    --radius:14px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#071226 0%, #07142a 60%);
    color:#e6eef6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
  }

  /* Nav */
  header{
    width:100%;
    max-width:1100px;
    padding:18px 20px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .brand{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    flex:1;
    text-align:center;
  }
  .title{
    font-family:'Playfair Display', serif;
    font-size:28px;
    letter-spacing:0.6px;
    font-weight:700;
    color: #ffffff;
    text-shadow: 0 4px 18px rgba(0,0,0,0.6);
  }
  nav{
    display:flex;
    gap:14px;
    align-items:center;
    justify-content:flex-end;
    flex:1;
  }
  nav a{
    color:var(--muted);
    text-decoration:none;
    padding:8px 12px;
    border-radius:8px;
    font-weight:600;
    transition:all .18s ease;
  }
  nav a:hover{ color:#fff; background:var(--glass); transform:translateY(-2px);}

  /* Controls row */
  .controls{
    width:100%;
    max-width:1100px;
    display:flex;
    gap:12px;
    align-items:center;
    padding:12px 20px 20px;
    flex-wrap:wrap;
  }
  .search{
    flex:1;
    display:flex;
    align-items:center;
    gap:10px;
    background:var(--glass);
    padding:10px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.03);
  }
  .search input{
    background:transparent;
    border:0; outline:0;
    color: #e9f2ff;
    width:100%;
    font-size:15px;
  }
  .btn{
    background:linear-gradient(90deg,var(--accent),#83b9ff);
    color:#042033;
    border:0;
    padding:10px 16px;
    border-radius:12px;
    font-weight:700;
    cursor:pointer;
    box-shadow: 0 8px 30px rgba(109,211,255,0.08);
    transition: transform .12s ease;
  }
  .btn:active{ transform:translateY(1px) }

  /* Library grid */
  main{
    width:100%;
    max-width:1100px;
    padding:0 20px 80px;
  }
  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
    gap:18px;
  }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    padding:12px;
    border:1px solid rgba(255,255,255,0.03);
    display:flex;
    flex-direction:column;
    gap:10px;
    min-height:220px;
    transition: transform .22s ease, box-shadow .22s ease;
  }
  .card:hover{ transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.55) }
  .thumb{
    height:120px;
    border-radius:10px;
    background:linear-gradient(180deg,#061226,#07132a);
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.02);
  }
  .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }

  .meta{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:8px;
  }
  .book-title{
    font-weight:700;
    font-size:15px;
    color:#fff;
    line-height:1.2;
  }
  .muted{ color:var(--muted); font-size:13px; }

  .card-footer{
    margin-top:auto;
    display:flex;
    gap:8px;
  }
  .btn-ghost{
    background:transparent;
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.03);
    padding:8px 10px;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
  }

  /* Modal */
  .modal-backdrop{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg,rgba(2,6,23,0.6), rgba(2,6,23,0.8));
    z-index:60;
  }
  .modal{
    width:100%;
    max-width:720px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:14px;
    padding:18px;
    border:1px solid rgba(255,255,255,0.03);
    box-shadow: 0 30px 80px rgba(0,0,0,0.7);
  }
  .field{
    display:flex;
    flex-direction:column;
    gap:8px;
    margin-bottom:10px;
  }
  label{ font-size:13px; color:var(--muted) }
  input[type="text"], input[type="url"], input[type="password"], textarea{
    background:var(--glass-2);
    border:1px solid rgba(255,255,255,0.03);
    padding:10px 12px;
    border-radius:10px;
    color:#eaf5ff;
    outline:none;
    font-size:14px;
  }
  textarea{ min-height:90px; resize:vertical; }
  .row{ display:flex; gap:10px; }
  .small{flex:0 0 120px}

  .thumb-preview{
    width:96px; height:96px; border-radius:10px; overflow:hidden; border:1px dashed rgba(255,255,255,0.04);
    display:flex; align-items:center; justify-content:center; background:transparent;
  }
  .helper{ font-size:12px; color:var(--muted) }

  .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }

  /* Empty state */
  .empty{
    text-align:center;
    color:var(--muted);
    padding:40px 20px;
    border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border:1px dashed rgba(255,255,255,0.02);
  }

  /* Responsive tweaks */
  @media (max-width:720px){
    .title{ font-size:22px; }
    header{ padding:12px 14px;}
    .controls{ padding:8px 14px 18px;}
  }

  /* Tiny animations */
  .fade-in{ animation: fadeIn .36s ease both; }
  @keyframes fadeIn{ from{opacity:0; transform:translateY(8px)} to{opacity:1; transform:none} }

  /* subtle focus outline */
  :focus{ outline: 2px solid rgba(109,211,255,0.12); outline-offset:2px; border-radius:8px; }

</style>
</head>
<body>
  <header>
    <div style="flex:1"></div>
    <div class="brand">
      <div class="title">Naseem-e-Sehar Library</div>
      <div class="helper" style="font-size:13px;color:var(--muted)">A clean modern digital library — open Drive PDFs in a new tab</div>
    </div>
    <nav aria-label="main-navigation" style="flex:1; justify-content:flex-end;">
      <a href="#" id="nav-home">Home</a>
      <a href="#library" id="nav-library">Library</a>
      <a href="#contact" id="nav-contact">Contact</a>
    </nav>
  </header>

  <div class="controls">
    <div class="search" role="search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="opacity:.8"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.4"/></svg>
      <input id="search" placeholder="Search books by title..." aria-label="Search books" />
    </div>
    <button class="btn" id="open-add">Add My Book</button>
    <button class="btn" id="export-btn" title="Export library JSON">Export</button>
    <button class="btn" id="import-btn" title="Import library JSON">Import</button>
  </div>

  <main>
    <section id="library">
      <div id="grid" class="grid"></div>
      <div id="empty" class="empty" style="display:none; margin-top:18px;">
        No books yet. Click <strong>Add My Book</strong> to add your first book.
      </div>
    </section>

    <section id="contact" style="margin-top:28px; color:var(--muted);">
      <h3 style="color:#fff">Contact</h3>
      <p class="muted">For help converting this to a shared (central) library using Firebase, contact me or ask in chat and I’ll generate the Firebase version.</p>
    </section>
  </main>

  <!-- Modal -->
  <div id="modal-backdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <h3 id="modal-title" style="margin:0 0 6px 0; font-family:'Playfair Display', serif;">Add / Edit Book</h3>
      <div class="field">
        <label>Book Title</label>
        <input type="text" id="book-title" placeholder="Enter book title" />
      </div>

      <div class="field">
        <label>Google Drive PDF Link (paste share link)</label>
        <input type="url" id="book-link" placeholder="https://drive.google.com/file/d/FILE_ID/view?usp=sharing" />
        <div class="helper">When clicked the PDF will open in a new tab. Use the Drive share link or a direct view link.</div>
      </div>

      <div class="row" style="align-items:center;">
        <div style="flex:1">
          <div class="field">
            <label>Optional Thumbnail (file)</label>
            <input type="file" id="thumb-upload" accept="image/*" />
            <div class="helper">Thumbnail will be embedded and saved locally (base64). Use small images for fast loading.</div>
          </div>
        </div>
        <div style="width:120px;">
          <div class="thumb-preview" id="thumb-preview">
            <div class="helper muted">No image</div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:8px;">
        <div style="flex:1">
          <label>Admin Password</label>
          <input type="password" id="admin-pass" placeholder="Enter admin password to save / delete" />
        </div>
        <div class="small">
          <label>Action</label>
          <select id="modal-action" style="padding:8px 10px; border-radius:8px; background:var(--glass-2); color:#eaf5ff; border:1px solid rgba(255,255,255,0.03);">
            <option value="add">Add New</option>
            <option value="edit">Edit Existing</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button class="btn-ghost" id="modal-cancel">Cancel</button>
        <button class="btn" id="modal-save">Save Book</button>
      </div>
    </div>
  </div>

<script>
/*
  Naseem-e-Sehar Library - Single-file JS
  - Persists books in localStorage under key "nes_library_v1"
  - Admin password default: 2299 (change below)
  - Thumbnails saved as base64 data URLs
*/

const ADMIN_PASSWORD = "2299"; // change this if you want a different admin password
const STORAGE_KEY = "nes_library_v1";

let books = []; // {id,title,link,thumbData,addedAt}
const grid = document.getElementById('grid');
const empty = document.getElementById('empty');
const searchInput = document.getElementById('search');

// modal elements
const modalBackdrop = document.getElementById('modal-backdrop');
const bookTitleInput = document.getElementById('book-title');
const bookLinkInput = document.getElementById('book-link');
const thumbUpload = document.getElementById('thumb-upload');
const thumbPreview = document.getElementById('thumb-preview');
const adminPassInput = document.getElementById('admin-pass');
const modalAction = document.getElementById('modal-action');
const modalSaveBtn = document.getElementById('modal-save');
const modalCancelBtn = document.getElementById('modal-cancel');
const openAddBtn = document.getElementById('open-add');

let editingId = null;

// util
function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,8); }
function saveToStorage(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(books)); }
function loadFromStorage(){ try { const raw = localStorage.getItem(STORAGE_KEY); books = raw ? JSON.parse(raw) : []; } catch(e){ console.error(e); books = []; } }
function showToast(msg){
  // quick lightweight toast
  const el = document.createElement('div');
  el.textContent = msg;
  el.style.position='fixed'; el.style.left='50%'; el.style.transform='translateX(-50%)'; el.style.bottom='28px';
  el.style.background='linear-gradient(90deg,var(--accent),#83b9ff)'; el.style.color='#042033'; el.style.padding='8px 14px';
  el.style.borderRadius='12px'; el.style.zIndex=1000; el.style.boxShadow='0 12px 30px rgba(0,0,0,0.5)';
  document.body.appendChild(el);
  setTimeout(()=> el.style.opacity='0',2200); setTimeout(()=> el.remove(),2600);
}

// Render functions
function renderGrid(filter=""){
  grid.innerHTML = "";
  const q = filter.trim().toLowerCase();
  const list = books.filter(b => !q || b.title.toLowerCase().includes(q));
  if(list.length === 0){
    empty.style.display = 'block';
  } else {
    empty.style.display = 'none';
    list.sort((a,b)=> b.addedAt - a.addedAt).forEach(book => {
      const card = document.createElement('article');
      card.className = 'card fade-in';
      card.innerHTML = `
        <div class="thumb" aria-hidden="true">
          ${ book.thumbData ? `<img src="${book.thumbData}" alt="thumbnail">` : `<svg width="64" height="64" viewBox="0 0 24 24" fill="none" style="opacity:.6"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.2"/><path d="M7 14h10M7 10h6" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/></svg>` }
        </div>
        <div class="meta">
          <div style="flex:1">
            <div class="book-title">${escapeHTML(book.title)}</div>
            <div class="muted" style="margin-top:6px; font-size:13px">Added: ${new Date(book.addedAt).toLocaleString()}</div>
          </div>
        </div>
        <div class="card-footer">
          <button class="btn" data-action="read" data-id="${book.id}">Read Now</button>
          <button class="btn-ghost" data-action="edit" data-id="${book.id}">Edit</button>
          <button class="btn-ghost" data-action="delete" data-id="${book.id}">Delete</button>
        </div>
      `;
      grid.appendChild(card);
    });
  }
}

function escapeHTML(s){ return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }

// Event wiring
grid.addEventListener('click', e => {
  const btn = e.target.closest('button');
  if(!btn) return;
  const action = btn.getAttribute('data-action');
  const id = btn.getAttribute('data-id');
  if(action === 'read'){
    const book = books.find(b=>b.id===id);
    if(!book) return showToast('Book not found');
    // open in new tab
    window.open(book.link, '_blank', 'noopener');
  } else if(action === 'edit'){
    startEdit(id);
  } else if(action === 'delete'){
    attemptDelete(id);
  }
});

openAddBtn.addEventListener('click', () => {
  modalAction.value = 'add';
  openModal();
});

modalCancelBtn.addEventListener('click', () => {
  closeModal();
});

modalBackdrop.addEventListener('click', (e) => {
  if(e.target === modalBackdrop) closeModal();
});

thumbUpload.addEventListener('change', async(e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f){ thumbPreview.innerHTML = '<div class="helper muted">No image</div>'; return; }
  if(f.size > 1024*1024*3){
    alert('Please use images smaller than 3MB for faster load.');
  }
  const data = await fileToDataURL(f);
  thumbPreview.innerHTML = `<img src="${data}" alt="thumb">`;
  thumbPreview.dataset.base64 = data;
});

function fileToDataURL(file){
  return new Promise((res,rej)=>{
    const fr = new FileReader();
    fr.onload = ()=> res(fr.result);
    fr.onerror = rej;
    fr.readAsDataURL(file);
  });
}

modalSaveBtn.addEventListener('click', async()=>{
  const title = (bookTitleInput.value||'').trim();
  const link = (bookLinkInput.value||'').trim();
  const password = adminPassInput.value || '';
  if(password !== ADMIN_PASSWORD){
    alert('Incorrect admin password.');
    return;
  }
  if(!title || !link){
    alert('Title and Drive link are required.');
    return;
  }
  // Optionally transform drive link? We'll save as provided.
  const thumbData = thumbPreview.dataset.base64 || null;
  if(modalAction.value === 'add'){
    const newBook = { id: uid(), title, link, thumbData, addedAt: Date.now() };
    books.push(newBook);
    saveToStorage();
    renderGrid(searchInput.value);
    showToast('Book added');
    closeModal();
  } else if(modalAction.value === 'edit' && editingId){
    const book = books.find(b=>b.id===editingId);
    if(!book) { alert('Editing target not found'); return; }
    book.title = title;
    book.link = link;
    book.thumbData = thumbData;
    saveToStorage();
    renderGrid(searchInput.value);
    showToast('Book updated');
    closeModal();
  }
});

function startEdit(id){
  const book = books.find(b=>b.id===id);
  if(!book) return showToast('Book not found');
  editingId = id;
  modalAction.value = 'edit';
  bookTitleInput.value = book.title;
  bookLinkInput.value = book.link;
  if(book.thumbData) {
    thumbPreview.innerHTML = `<img src="${book.thumbData}" alt="thumb">`;
    thumbPreview.dataset.base64 = book.thumbData;
  } else {
    thumbPreview.innerHTML = `<div class="helper muted">No image</div>`;
    delete thumbPreview.dataset.base64;
  }
  adminPassInput.value = '';
  openModal();
}

function attemptDelete(id){
  const pass = prompt("Enter admin password to delete this book:");
  if(pass !== ADMIN_PASSWORD){
    alert("Incorrect password. Delete aborted.");
    return;
  }
  const idx = books.findIndex(b=>b.id===id);
  if(idx >= 0){
    books.splice(idx,1);
    saveToStorage();
    renderGrid(searchInput.value);
    showToast('Book deleted');
  } else {
    alert('Book not found.');
  }
}

// modal open/close
function openModal(){
  modalBackdrop.style.display = 'flex';
  setTimeout(()=> modalBackdrop.style.opacity = '1', 10);
  bookTitleInput.focus();
}
function closeModal(){
  modalBackdrop.style.opacity = '0';
  setTimeout(()=> modalBackdrop.style.display = 'none', 220);
  editingId = null;
  // clear inputs
  bookTitleInput.value = '';
  bookLinkInput.value = '';
  thumbUpload.value = '';
  thumbPreview.innerHTML = '<div class="helper muted">No image</div>';
  delete thumbPreview.dataset.base64;
  adminPassInput.value = '';
}

// search
searchInput.addEventListener('input', e => {
  renderGrid(e.target.value);
});

// export/import handlers
document.getElementById('export-btn').addEventListener('click', ()=>{
  const dataStr = JSON.stringify(books, null, 2);
  const blob = new Blob([dataStr], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'nes-library-export.json'; a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('import-btn').addEventListener('click', ()=>{
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'application/json';
  input.onchange = async (e)=>{
    const f = e.target.files[0];
    if(!f) return;
    try{
      const txt = await f.text();
      const parsed = JSON.parse(txt);
      if(!Array.isArray(parsed)){ alert('Invalid import file'); return; }
      // basic shape check. Merge or replace? Ask quietly: we'll append imported ones.
      const cleaned = parsed.map(p => ({
        id: p.id || uid(),
        title: p.title || 'Untitled',
        link: p.link || '#',
        thumbData: p.thumbData || null,
        addedAt: p.addedAt || Date.now()
      }));
      books = books.concat(cleaned);
      saveToStorage();
      renderGrid(searchInput.value);
      showToast('Imported ' + cleaned.length + ' book(s)');
    } catch(err){ console.error(err); alert('Failed to import: ' + err.message) }
  };
  input.click();
});

// basic nav
document.getElementById('nav-home').addEventListener('click', (e)=>{ e.preventDefault(); window.scrollTo({top:0, behavior:'smooth'})});
document.getElementById('nav-library').addEventListener('click', (e)=>{ e.preventDefault(); document.getElementById('library').scrollIntoView({behavior:'smooth'})});
document.getElementById('nav-contact').addEventListener('click', (e)=>{ e.preventDefault(); document.getElementById('contact').scrollIntoView({behavior:'smooth'})});

// init
(function init(){
  loadFromStorage();
  renderGrid();
})();
</script>
</body>
</html>
